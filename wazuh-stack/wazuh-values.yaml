# =============================================================================
# Wazuh Helm Values para ZCloud (k3s híbrido)
# Chart: morgoved/wazuh-helm v1.0.9
# =============================================================================
# IMPORTANTE: Wazuh NO tiene imágenes ARM64, todo debe correr en 'lake' (x86_64)
# PRERREQUISITO: kubectl apply -f wazuh-secrets.yaml
# =============================================================================

cert-manager:
  enabled: false

certificates:
  enabled: true
  issuer:
    name: null
    type: issuer
  duration: 2160h
  renewBefore: 360h

# =============================================================================
# WAZUH INDEXER (OpenSearch)
# =============================================================================
indexer:
  enabled: true
  replicas: 1
  
  nodeSelector:
    kubernetes.io/hostname: lake
  
  images:
    repository: wazuh/wazuh-indexer
    tag: "4.14.1"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: 300m
      memory: 1Gi
    limits:
      cpu: 1000m
      memory: 2Gi
  
  env:
    OPENSEARCH_JAVA_OPTS: "-Xms1g -Xmx1g -Dlog4j2.formatMsgNoLookups=true"
    CLUSTER_NAME: "wazuh"
    NETWORK_HOST: "0.0.0.0"
    DISABLE_INSTALL_DEMO_CONFIG: "true"
  
  storageClass: nfs-nvme
  storageSize: 50Gi
  
  service:
    type: ClusterIP
    httpPort: 9200
    nodes: 9300
    metrics: 9600
  
  # Credenciales via existingSecret (el chart lee INDEXER_PASSWORD y INDEXER_PASSWORD_HASH)
  cred:
    existingSecret: "wazuh-credentials"
  
  pdb:
    enabled: false
  
  networkPolicy:
    enabled: false

# =============================================================================
# WAZUH MANAGER
# =============================================================================
wazuh:
  enabled: true
  
  nodeSelector:
    kubernetes.io/hostname: lake
  
  # Cluster key - debe estar en el values (no soporta existingSecret para esto)
  key: "93b1ec5421dfce6da16b5b159b8fb3de"
  
  syslog_enable: true
  
  images:
    repository: wazuh/wazuh-manager
    tag: "4.14.1"
    pullPolicy: IfNotPresent
  
  env:
    FILEBEAT_SSL_VERIFICATION_MODE: full
  
  # API credentials via existingSecret (el chart lee API_USERNAME y API_PASSWORD)
  apiCred:
    existingSecret: "wazuh-credentials"
  
  # Authd via existingSecret (el chart lee authd.pass)
  authd:
    enabled: true
    existingSecret: "wazuh-credentials"
  
  master:
    enabled: true
    
    resources:
      requests:
        cpu: 300m
        memory: 512Mi
      limits:
        cpu: 800m
        memory: 1Gi
    
    service:
      type: ClusterIP
    
    storageClass: nfs-nvme
    storageSize: 20Gi
    
    networkPolicy:
      enabled: false
  
  worker:
    enabled: false
    replicas: 0

# =============================================================================
# WAZUH DASHBOARD
# =============================================================================
dashboard:
  enabled: true
  replicas: 1
  
  nodeSelector:
    kubernetes.io/hostname: lake
  
  images:
    repository: wazuh/wazuh-dashboard
    tag: "4.14.1"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi
  
  enable_ssl: false
  
  # Credenciales via existingSecret 
  # El chart lee DASHBOARD_USERNAME, DASHBOARD_PASSWORD, DASHBOARD_PASSWORD_HASH
  # ⚠️ DASHBOARD_USERNAME DEBE ser "kibanaserver"
  cred:
    existingSecret: "wazuh-credentials"
  
  service:
    type: ClusterIP
    httpPort: 5601
  
  ingress:
    enabled: true
    className: "traefik"
    host: "wazuh.zyrak.cloud"
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
      traefik.ingress.kubernetes.io/router.tls: "true"
      cert-manager.io/cluster-issuer: letsencrypt-prod
    tls:
      - secretName: wazuh-dashboard-tls
        hosts:
          - wazuh.zyrak.cloud
  
  networkPolicy:
    enabled: false
  
  pdb:
    enabled: false

# =============================================================================
# WAZUH AGENT (deshabilitado inicialmente)
# =============================================================================
agent:
  enabled: false
  
  images:
    repository: wazuh/wazuh-agent
    tag: "4.14.1"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi

externalIndexer:
  enabled: false
